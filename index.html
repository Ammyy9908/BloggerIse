<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sir mvit Ise Dept</title>
    <link rel="stylesheet" href="bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <link rel="stylesheet" href="index.css">
  </head>
  <body>
      <nav class="navbar" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
              <a class="navbar-item" href="">
                <!--<img src="https://bulma.io/images/bulma-logo.png" width="112" height="28">-->
                <strong>Geek Blog</strong>
              </a>
          
              <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>
          
            <div id="navbarBasicExample" class="navbar-menu">
              
          
              <div class="navbar-end">
                <div class="navbar-item">
                  <div class="buttons">
                    <a class="button is-primary" id="signup" style="display: none;">
                      <strong>Sign up</strong>
                    </a>
                    <a class="button is-light" id="login" style="display: none;">
                      Log in
                    </a>
                    <a class="button is-transparent"  id="profile" style="display: none;border:none;">
                        Your Profile
                      </a>
                      <a class="button is-link" id="add_blog" style="display: none;">
                        Add Blog
                      </a>
                    <a class="button is-success" id="logout" style="display: none;">
                        Log out
                      </a>

                     
                  </div>
                </div>
              </div>
            </div>
          </nav>
          <section class="hero ">
            <div class="hero-body">
              <div class="container">
                <div class="columns">
                  <div class="column is-8 is-offset-2">
                    <figure class="image is-16by9">
                      <img src="first-post.png" alt="image" id="image">
                    </figure>
                  </div>
                </div>
        
                <section class="section">
                  <div class="columns">
                    <div class="column is-8 is-offset-2">
                      <div class="content is-medium">
                        <!--<h2 class="subtitle is-4">December 25, 2018</h2>-->
                        
                      </div>
                    </div>
                  </div>
                </section>
        
               
        
        
              </div>
            </div>
          </section>

          <footer class="footer">
            <div class="content has-text-centered">
              <p>
                <strong>Geek Blogs copyright 2020</strong> Developed by
                <a href="https://ammyy9908.github.io/PortfolioSumit/">Sumit</a>
              </p>
            </div>
          </footer>
        
         
        
         


       <!--profile modal-->
       <div class="modal">
            <div class="modal-background"></div>
            <div class="modal-content">
              <p class="image is-4by3">
                <img src="https://bulma.io/images/placeholders/1280x960.png" alt="">
              </p>
            </div>
            <button class="modal-close is-large" aria-label="close"></button>
          </div>

          <!--signup form modal-->

          <div class="modal" id="signup-form">
            <div class="modal-background"></div>
            <div class="modal-content">
              <div class="box">
                    <form action="" class="controls" id="form-signup">
                        <div class="field">
                              <label class="label">Email</label>
                              <div class="control">
                                <input class="input" type="text" placeholder="Email" id="email">
                              </div>
                            </div>

                            <div class="field">
                              <label class="label">Create Password</label>
                              <div class="control">
                                <input class="input" type="text" placeholder="Create Password" id="password">
                              </div>
                            </div>
                            <div class="field">
                              
                              <div class="control">
                                <button id="submitsignup" class="button is-dark" type="submit">Sign up</button>
                              </div>
                            </div>
                    </form>
                  
              </div>
            </div>
            <button class="modal-close is-large" aria-label="close" id="close"></button>
          </div>

          <!--login form modal-->

          <div class="modal" id="login-form">
            <div class="modal-background"></div>
            <div class="modal-content">
                  <div class="box">
                        <form action="" class="controls" id="form-login">
                            <div class="field">
                                  <label class="label">Email</label>
                                  <div class="control">
                                    <input class="input" type="text" placeholder="Email" id="emaillogin">
                                  </div>
                                </div>
    
                                <div class="field">
                                  <label class="label">Password</label>
                                  <div class="control">
                                    <input class="input" type="text" placeholder="Create Password" id="passwordlogin">
                                  </div>
                                </div>
                                <div class="field">
                                  
                                    <div class="control">
                                      <a id="forget" class="is-warning">Forgot Password?</a>
                                    </div>
                                  </div>
                                <div class="field">
                                  
                                  <div class="control">
                                    <button id="loginsubmit" class="button is-light" type="submit">Login</button>
                                  </div>
                                </div>
                        </form>
                      
                  </div>
            </div>
            <button class="modal-close is-large" aria-label="close" id="closelogin"></button>
          </div>


           <!--Forgot Password modal-->

           <div class="modal" id="forget-form">
            <div class="modal-background"></div>
            <div class="modal-content">
                  <div class="box">
                        <form action="" class="controls" id="form-forget">
                            <div class="field">
                                  <label class="label">Provide Registered Email</label>
                                  <div class="control">
                                    <input class="input" type="text" placeholder="Email" id="emailforget">
                                  </div>
                                </div>
    
                                <div class="field">
                                  
                                  <div class="control">
                                    <button id="forgetsubmit" class="button is-dark" type="submit">Forget Password</button>
                                  </div>
                                </div>
                        </form>
                      
                  </div>
            </div>
            <button class="modal-close is-large" aria-label="close" id="closeforget"></button>
          </div>

          <!--add Blog form modal-->

          <div class="modal" id="blog-form">
            <div class="modal-background"></div>
            <div class="modal-content">
                  <div class="box">
                        <form action="" class="controls" id="form-blog">
                            <div class="field">
                                  <label class="label">Blog Title</label>
                                  <div class="control">
                                    <input class="input" type="text" placeholder="Blog Title" id="blogtitle">
                                  </div>
                                </div>
    
                                <div class="field">
                                  <label class="label">Blog Description</label>
                                  <div class="control">
                                    <textarea class="textarea" placeholder="10 lines of textarea" rows="12" id="desc"></textarea>
                                  </div>
                                </div>
                                <div class="field">
                                    <label class="label">Source URL:</label>
                                    <div class="control has-icons-left has-icons-right">
                                      <input class="input" type="text" placeholder="Post Source URL..." id="url">
                                      <span class="icon is-small is-left">
                                        <i class="fas fa-link"></i>
                                      </span>
                                      <span class="icon is-small is-right">
                                        <i class="fas fa-check"></i>
                                      </span>
                                    </div>
                                    
                                  </div>
                                <div class="field">
                                  
                                  <div class="control">
                                    <button class="button is-primary" type="submit" id="blogsubmit">Submit</button>
                                  </div>
                                </div>
                        </form>
                      
                  </div>
            </div>
            <button class="modal-close is-large" aria-label="close" id="closeblog"></button>
          </div>



<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>


          <!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-auth.js"></script>

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyCMK5HQzBHVrjfnJUw2kifS800iubSO4Nk",
    authDomain: "sir-mvit-blog.firebaseapp.com",
    databaseURL: "https://sir-mvit-blog.firebaseio.com",
    projectId: "sir-mvit-blog",
    storageBucket: "sir-mvit-blog.appspot.com",
    messagingSenderId: "160349909662",
    appId: "1:160349909662:web:1b5f712a7a109c53df818f",
    measurementId: "G-71RMEJSLER"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();

  // make firebase and firestore reference;

  const auth=firebase.auth();
  const db=firebase.firestore();



</script>

<script>
      $(document).ready(function()
{
       // Check for click events on the navbar burger icon
  $(".navbar-burger").click(function() {

// Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
$(".navbar-burger").toggleClass("is-active");
$(".navbar-menu").toggleClass("is-active");

});

//trigger blog modal
$('#add_blog').on('click',function(){
$('#blog-form').addClass('is-active');

$('#closeblog').on('click',function(){
$('#blog-form').removeClass('is-active');

});
});


            //insert data to dom elements

            const domelement=document.querySelector('.content');

            const setUpData=(data)=>{
                  if(data.length)
                  {
                        let html="";
                  data.forEach(doc => {
                        const blogs=doc.data();
                        console.log(blogs);
                        const content=`
                        <h1 class="title">${blogs.title}</h1>
                        <p class="subtitle">post by:${blogs.by}</p>
                        <p>${blogs.description}</p>
                        <a href="${blogs.url}" class="button is-link">Read Full Post</a>
                        `;
                        html+=content;
                  });
                  domelement.innerHTML=html;
                  }
                  else
                  {     $('#image').attr('src','connection.png');
                        domelement.innerHTML="<h1 class='title'>Error While Loading Blog Content From Data</h1><p class='subtitle'>Make Sure Internet connection Turned On</p>";   
                  }
            }

            
      
//check auth status

auth.onAuthStateChanged(user=>{
      if(user)
      {
            console.log('User logged In!');
            $('#profile').html(user.email);
            
      $('#logout').css('display','block');
      $('#add_blog').css('display','block');
      $('#profile').css('display','block');
      $('#signup').css('display','none');
      $('#login').css('display','none');
      //send the blog to database
      $('#form-blog').on('submit',function(e)
{
      $('#blogsubmit').addClass('is-loading');
   e.preventDefault();   
const blogtitle=$('#blogtitle').val();
const desc=$('#desc').val();
const link=$('#url').val();

db.collection('blogs').add({
      title:blogtitle,
      by:user.email,
      description:desc,
      url:link
}).then(()=>{
      console.log('Blog Added!');
      $('#blog-form').removeClass('is-active');
      $('#form-blog').trigger("reset");
      
     
}).error(err=>{
      console.log(err.message);
      domelement.innerHTML=`<h1 class='title'>${err.message}</h1>`;  
});

});
      //get blog data
      db.collection('blogs').onSnapshot(snapshot=>{
            console.log(snapshot.docs);
            setUpData(snapshot.docs);
      });
      }
      else
      {
            console.log('User Logged out!');
            $('#logout').css('display','none');
            $('#add_blog').css('display','none');
            $('#profile').css('display','none');
            $('#signup').css('display','inline-block');
            $('#login').css('display','inline-block');
            domelement.innerHTML="<h1 class='title'>You have to Logged In First!</h1>"; 
      }
})

//signup
$('#signup').on('click',function()
{
$('#signup-form').addClass('is-active');

//close the form on submit the form by default
$('#close').on('click',function(){
$('#signup-form').removeClass('is-active');
});



$('#form-signup').on('submit',function(e)
{
e.preventDefault();
const email=$('#email').val();
const password=$('#password').val();
$('#submitsignup').addClass('is-loading');

auth.createUserWithEmailAndPassword(email,password).then(cred=>{
console.log(cred.user);
$('#signup-form').removeClass('is-active');
$('#form-signup').trigger("reset");

}).catch(function(error){
      console.log(error.message);
      console.log('Error Occurred!');
      domelement.innerHTML="<p class='subtitle has-text-danger'>"+error.message+"</p>";
      $('#signup-form').removeClass('is-active');
      $('#form-signup').trigger("reset");
});

});




});


//logout the user

$('#logout').on('click',function()
{
auth.signOut().then(()=>{
      
})
});



//login user

$('#login').on('click',function()
{
$('#login-form').addClass('is-active');

//close the form on submit the form by default
$('#closelogin').on('click',function(){
$('#login-form').removeClass('is-active');
});



$('#form-login').on('submit',function(e)
{
e.preventDefault();
const email=$('#emaillogin').val();
const password=$('#passwordlogin').val();
$('#loginsubmit').addClass('is-loading');

auth.signInWithEmailAndPassword(email,password).then(cred=>{
//console.log(cred.user);
$('#login-form').removeClass('is-active');
$('#form-login').trigger("reset");
}).catch(function(error){
      console.log(error.message);
      console.log('Error Occurred!');
      domelement.innerHTML="<p class='subtitle has-text-danger'>"+error.message+"</p>";
      $('#login-form').removeClass('is-active');
});

});


//forgot password

$('#forget').on('click',function(){
      $('#login-form').removeClass('is-active');
      $('#forget-form').addClass('is-active');

      

      //close the forget password dialogue on close button click
      $('#closeforget').on('click',function(){
            $('#forget-form').removeClass('is-active');
      });

      

});


$('#form-forget').on('submit',function(e){
      e.preventDefault();
            const emailforget=$('#emailforget').val();
            if(emailforget!="")
            {
                  auth.sendPasswordResetEmail(emailforget).then(()=>{
                        domelement.innerHTML="<p class='subtitle has-text-success'>Email Sented Please Check Email.</p>";
                        $('#forget-form').removeClass('is-active');
                  }).catch((error)=>{
                        console.log(error.message);
                        domelement.innerHTML="<p class='subtitle has-text-danger'>"+error.message+"</p>";
                        console.log('Email Not Found!');
                  })
            }
            else
            {
                  domelement.innerHTML="<p class='subtitle has-text-danger'>Email Required</p>"; 
                  $('#forget-form').removeClass('is-active');  
            }

      });




});







});
</script>


  </body>
</html>